<!doctype html><html lang=ja><head><title>dotfiles には dotbot を添えて ::
blog.skmatz.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="dotfiles とは この記事を読むような人は知っている人が多そうですが、要するにアプリケーションの設定ファイルです。
よく見るのは Vim や Zsh の設定ですが、Arch Linux 系の OS やタイル型ウィンドウマネージャを使っている人はかなりの量の設定ファイルを管理していると思います。
適切に dotfiles を管理することで、新しいマシンを購入したときでも一瞬で同じ作業環境を構成できます。
一般的？には、dotfiles 用のリポジトリを作ってすべての設定ファイルを集約させた後、手動または自作スクリプトでシンボリックリンクを貼る方法が紹介されています。
この作業を含め、アプリケーションのインストールなど、環境構築に必要な作業を自動化してくれるのが dotbot です。
dotbot とは 
dotbot は dotfiles の管理を簡単にしてくれる Python 製のツールです。
Python 製なのでランタイムに Python を必要としますが、Linux 系なら基本的にシステムにインストールされているはずなので、とくに気にする必要はないです。
インストール PyPI に公開されているので、
pip install [--user] dotbot とかでもインストールできますが、依存を増やさないためにもサブモジュールとして dotfiles のためのリポジトリ内に追加する方法が推奨されています。
mkdir dotfiles cd dotfiles git init git submodule add https://github.com/anishathalye/dotbot cp dotbot/tools/git-submodule/install . touch install.conf.yaml 5 行目でコピーしているのは dotbot をいい感じに実行するための shell script です。
以降は 6 行目で作成した install.conf.yaml を編集し、"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.skmatz.com/posts/dotbot/><link rel=stylesheet href=https://blog.skmatz.com/assets/style.css><link rel=stylesheet href=https://blog.skmatz.com/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://blog.skmatz.com/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://blog.skmatz.com/img/favicon.png><link href=https://blog.skmatz.com/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://blog.skmatz.com/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://blog.skmatz.com/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://blog.skmatz.com/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://blog.skmatz.com/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://blog.skmatz.com/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="dotfiles には dotbot を添えて"><meta name=twitter:description content="まさか手動でシンボリックリンクを貼っていませんよね？"><meta property="og:title" content="dotfiles には dotbot を添えて"><meta property="og:description" content="まさか手動でシンボリックリンクを貼っていませんよね？"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.skmatz.com/posts/dotbot/"><meta property="article:published_time" content="2021-01-01T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-01T00:00:00+00:00"><meta property="og:site_name" content="blog.skmatz.com"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>blog.skmatz.com</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>dotfiles には dotbot を添えて</h1><div class=post-meta><span class=post-date>2021-01-01</span>
<span class=post-author>— Written by Shunta Komatsu</span>
<span class=post-read-time>— 2 min read</span></div><div class=post-content><h2>Table of Contents</h2><aside class=table-of-contents><nav id=TableOfContents><ul><li><a href=#dotfiles-とは>dotfiles とは</a></li><li><a href=#dotbot-とは>dotbot とは</a></li><li><a href=#インストール>インストール</a></li><li><a href=#設定>設定</a><ul><li><a href=#link>Link</a></li><li><a href=#create>Create</a></li><li><a href=#shell>Shell</a></li><li><a href=#clean>Clean</a></li><li><a href=#defaults>Defaults</a></li></ul></li><li><a href=#プラグイン>プラグイン</a></li><li><a href=#コマンドライン引数>コマンドライン引数</a></li></ul></nav></aside><h2 id=dotfiles-とは>dotfiles とは</h2><p>この記事を読むような人は知っている人が多そうですが、要するにアプリケーションの設定ファイルです。<br>よく見るのは Vim や Zsh の設定ですが、Arch Linux 系の OS やタイル型ウィンドウマネージャを使っている人はかなりの量の設定ファイルを管理していると思います。</p><p>適切に dotfiles を管理することで、新しいマシンを購入したときでも一瞬で同じ作業環境を構成できます。<br>一般的？には、dotfiles 用のリポジトリを作ってすべての設定ファイルを集約させた後、手動または自作スクリプトでシンボリックリンクを貼る方法が紹介されています。</p><p>この作業を含め、アプリケーションのインストールなど、環境構築に必要な作業を自動化してくれるのが dotbot です。</p><h2 id=dotbot-とは>dotbot とは</h2><p><a href=https://github.com/anishathalye/dotbot><img src=https://gh-card.dev/repos/anishathalye/dotbot.svg alt=anishathalye/dotbot></a></p><p>dotbot は dotfiles の管理を簡単にしてくれる Python 製のツールです。<br>Python 製なのでランタイムに Python を必要としますが、Linux 系なら基本的にシステムにインストールされているはずなので、とくに気にする必要はないです。</p><h2 id=インストール>インストール</h2><p>PyPI に公開されているので、</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pip install <span style=color:#f92672>[</span>--user<span style=color:#f92672>]</span> dotbot
</code></pre></div><p>とかでもインストールできますが、依存を増やさないためにもサブモジュールとして dotfiles のためのリポジトリ内に追加する方法が推奨されています。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir dotfiles
cd dotfiles
git init
git submodule add https://github.com/anishathalye/dotbot
cp dotbot/tools/git-submodule/install .
touch install.conf.yaml
</code></pre></div><p>5 行目でコピーしているのは dotbot をいい感じに実行するための shell script です。</p><p>以降は 6 行目で作成した <code>install.conf.yaml</code> を編集し、</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./install
</code></pre></div><p>と実行する流れです。</p><h2 id=設定>設定</h2><p>dotbot でできることは、</p><ul><li>link: シンボリックリンクの作成</li><li>create: ディレクトリの作成</li><li>shell: シェルの実行</li><li>clean: シンボリックリンクの削除</li></ul><p>です。<br>これに加えてプラグイン機構を備えているので、任意のプラグインを追加することで apt や pacman でアプリケーションをインストールするといったこともできます。</p><h3 id=link>Link</h3><p>link ディレクティブはシンボリックリンクを作成します。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>link</span>:
    <span style=color:#f92672>~/.config/i3</span>: <span style=color:#ae81ff>i3</span>
    <span style=color:#f92672>~/.zshrc</span>: <span style=color:#ae81ff>.zshrc</span>
</code></pre></div><p>このような感じで、key に登録名、value に実体へのパスを列挙します。<br>実体へのパスがディレクトリの場合でもファイルの場合でも意図通りにリンクが貼られます。</p><p>また、各オプションを利用する場合は次のように書きます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>link</span>:
    <span style=color:#f92672>~/.config/i3</span>:
      <span style=color:#f92672>path</span>: <span style=color:#ae81ff>i3</span>
      <span style=color:#f92672>relink</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p><code>path</code> がさきほどの value に該当し、その他のオプションを並べます。<br>いくつかオプションがありますが、<code>create</code> と <code>relink</code> は常に <code>true</code> でいいような気がします (後に紹介する defaults ディレクティブで設定することをオススメします)。</p><h3 id=create>Create</h3><p>create ディレクティブはディレクトリを作成します。<br>次のように作成するディレクトリへのパスを列挙します。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>create</span>:
    - <span style=color:#ae81ff>~/sandbox</span>
    - <span style=color:#ae81ff>~/workspace</span>
</code></pre></div><h3 id=shell>Shell</h3><p>shell ディレクティブはシェルを実行します。<br>コマンドのみ列挙する場合は次のように書きます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>shell</span>:
    - <span style=color:#ae81ff>chsh -s $(which zsh)</span>
</code></pre></div><p>標準入力や標準出力を要する場合は次のように書きます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>shell</span>:
    - <span style=color:#f92672>command</span>: <span style=color:#ae81ff>chsh -s $(which zsh)</span>
      <span style=color:#f92672>stdin</span>: <span style=color:#66d9ef>true</span>
      <span style=color:#f92672>stdout</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><h3 id=clean>Clean</h3><p>clean ディレクティブはリンクが切れているシンボリックリンクの削除を行います。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>clean</span>: [<span style=color:#e6db74>&#34;~&#34;</span>]
</code></pre></div><p>オプションを利用する場合は次のように書きます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>clean</span>:
    <span style=color:#f92672>~/</span>:
      <span style=color:#f92672>force</span>: <span style=color:#66d9ef>true</span>
    <span style=color:#f92672>~/.config</span>:
      <span style=color:#f92672>recursive</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><h3 id=defaults>Defaults</h3><p>defaults ディレクティブは規定の設定を上書きします。<br>defaults ディレクティブはファイルのどこに何回書いても良いですが、書いた場所以降の設定が変更されることに注意が必要です。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>defaults</span>:
    <span style=color:#f92672>link</span>:
      <span style=color:#f92672>create</span>: <span style=color:#66d9ef>true</span>
      <span style=color:#f92672>relink</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p>多用することはないと思いますが、上の 2 つの項目はデフォルトに設定しておくことを推奨します。</p><h2 id=プラグイン>プラグイン</h2><p>dotbot はプラグイン機構を備えており、OSS で作成されたプラグインなどをサブモジュールとして追加しておくことで、さまざまなことができるようになります。</p><p><a href=https://github.com/anishathalye/dotbot/wiki/Plugins>wiki</a> に利用可能なプラグインの表が記載されています。</p><p>たとえば <a href=https://github.com/oxson/dotbot-yay>oxson/dotbot-yay</a> は次のように書くことで、Arch Linux の AUR パッケージマネージャである <a href=https://github.com/Jguer/yay>Yay</a> を使って列挙したアプリケーションをインストールしてくれます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>yay</span>:
    - <span style=color:#ae81ff>alacritty</span>
    - <span style=color:#ae81ff>tmux</span>
    - <span style=color:#ae81ff>zsh</span>
</code></pre></div><h2 id=コマンドライン引数>コマンドライン引数</h2><p>冒頭にも書いたように、基本的には <code>install.conf.yaml</code> を編集したら、</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./install
</code></pre></div><p>と実行するだけですが、次のようにオプションを渡すことができます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./install --only link
</code></pre></div><p><code>--only</code> オプションは実行するディレクティブを限定できます。<br>これにより、新しいシンボリックリンクを作成したいたけなのにパッケージのインストーラが走るみたいなことを防ぐことができます。</p></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>blog.skmatz.com</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2021 Shunta Komatsu</span></div></div></footer><script src=https://blog.skmatz.com/assets/main.js></script><script src=https://blog.skmatz.com/assets/prism.js></script></div></body></html>